<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mon Planning</title>

<style>
:root {
    --bg: #0f172a;
    --card: #1e293b;
    --accent: #3b82f6;
    --text: #f1f5f9;
    --muted: #94a3b8;
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
}

body {
    background: var(--bg);
    color: var(--text);
    display: flex;
    justify-content: center;
    padding: 20px;
}

.container {
    width: 100%;
    max-width: 500px;
}

.header {
    text-align: center;
    margin-bottom: 25px;
}

.week-title {
    font-size: 20px;
    font-weight: 600;
}

.week-dates {
    font-size: 14px;
    color: var(--muted);
    margin-top: 5px;
}

.search-title {
    text-align: center;
    margin: 20px 0 15px;
    font-size: 18px;
    font-weight: 500;
}

.search-box {
    display: flex;
    gap: 10px;
    margin-bottom: 25px;
}

input {
    flex: 1;
    padding: 12px;
    border-radius: 10px;
    border: none;
    outline: none;
    font-size: 16px;
}

button {
    padding: 12px 18px;
    border-radius: 10px;
    border: none;
    background: var(--accent);
    color: white;
    font-weight: 600;
    cursor: pointer;
}

button:hover {
    opacity: 0.9;
}

.card {
    background: var(--card);
    padding: 18px;
    border-radius: 16px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    display: none;
}

.agent-name {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 15px;
}

.day {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid rgba(255,255,255,0.05);
}

.day:last-child {
    border-bottom: none;
}

.day-name {
    color: var(--muted);
}

.error {
    text-align: center;
    margin-top: 15px;
    color: #ef4444;
}
</style>
</head>
<body>

<div class="container">

    <div class="header">
        <div id="weekTitle" class="week-title">Chargement...</div>
        <div id="weekDates" class="week-dates"></div>
    </div>

    <div class="search-title">Consulter mon planning</div>

    <div class="search-box">
        <input type="text" id="ccmsInput" placeholder="Entrer votre BMS / CCMS">
        <button onclick="chercherPlanning()">OK</button>
    </div>

    <div id="result" class="card"></div>
    <div id="error" class="error"></div>

</div>

<script>

let planningData = [];
let semaine = null;
let annee = null;

// Calculer les dates lundi → dimanche à partir semaine ISO
function getWeekDates(year, week) {
    const simple = new Date(year, 0, 1 + (week - 1) * 7);
    const dow = simple.getDay();
    const ISOweekStart = simple;

    if (dow <= 4)
        ISOweekStart.setDate(simple.getDate() - simple.getDay() + 1);
    else
        ISOweekStart.setDate(simple.getDate() + 8 - simple.getDay());

    const monday = new Date(ISOweekStart);
    const sunday = new Date(ISOweekStart);
    sunday.setDate(monday.getDate() + 6);

    return { monday, sunday };
}

// Charger JSON
fetch("planning_complet.json")
    .then(res => res.json())
    .then(data => {

        semaine = data.semaine;
        annee = data.annee;
        planningData = data.agents;

        document.getElementById("weekTitle").textContent =
            `Planning S${semaine} – ${annee}`;

        const { monday, sunday } = getWeekDates(annee, semaine);

        const options = { day: 'numeric', month: 'long' };

        document.getElementById("weekDates").textContent =
            `Du ${monday.toLocaleDateString('fr-FR', options)} ` +
            `au ${sunday.toLocaleDateString('fr-FR', options)}`;
    })
    .catch(err => {
        document.getElementById("weekTitle").textContent =
            "Impossible de charger le planning";
        console.error(err);
    });

function chercherPlanning() {
    const ccms = document.getElementById("ccmsInput").value.trim();
    const resultDiv = document.getElementById("result");
    const errorDiv = document.getElementById("error");

    resultDiv.style.display = "none";
    errorDiv.textContent = "";

    if (!ccms) {
        errorDiv.textContent = "Veuillez entrer un BMS.";
        return;
    }

    const agent = planningData.find(a => a.ccms === ccms);

    if (!agent) {
        errorDiv.textContent = "Aucun planning trouvé pour ce BMS.";
        return;
    }

    let html = `<div class="agent-name">${agent.nom}</div>`;

    for (const [jour, heures] of Object.entries(agent.planning)) {
        html += `
            <div class="day">
                <div class="day-name">${jour}</div>
                <div>
                    ${heures.debut ? heures.debut : "--:--"} -
                    ${heures.fin ? heures.fin : "--:--"}
                </div>
            </div>
        `;
    }

    resultDiv.innerHTML = html;
    resultDiv.style.display = "block";
}
</script>

</body>
</html>
